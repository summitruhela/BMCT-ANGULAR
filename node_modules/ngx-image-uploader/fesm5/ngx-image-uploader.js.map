{"version":3,"file":"ngx-image-uploader.js.map","sources":["ng://ngx-image-uploader/lib/file-queue-object.ts","ng://ngx-image-uploader/lib/image-uploader.service.ts","ng://ngx-image-uploader/lib/utils.ts","ng://ngx-image-uploader/lib/image-uploader.component.ts","ng://ngx-image-uploader/lib/image-uploader.module.ts"],"sourcesContent":["import { HttpResponse, HttpErrorResponse } from '@angular/common/http';\r\nimport { Subscription } from 'rxjs';\r\n\r\nimport { FileQueueStatus } from './file-queue-status';\r\n\r\nexport class FileQueueObject {\r\n  public file: any;\r\n  public status: FileQueueStatus = FileQueueStatus.Pending;\r\n  public progress: number = 0;\r\n  public request: Subscription = null;\r\n  public response: HttpResponse<any> | HttpErrorResponse = null;\r\n\r\n  constructor(file: any) {\r\n    this.file = file;\r\n  }\r\n\r\n  // actions\r\n  // public upload = () => { /* set in service */ };\r\n  // public cancel = () => { /* set in service */ };\r\n  // public remove = () => { /* set in service */ };\r\n\r\n  // statuses\r\n  public isPending = () => this.status === FileQueueStatus.Pending;\r\n  public isSuccess = () => this.status === FileQueueStatus.Success;\r\n  public isError = () => this.status === FileQueueStatus.Error;\r\n  public inProgress = () => this.status === FileQueueStatus.Progress;\r\n  public isUploadable = () => this.status === FileQueueStatus.Pending || this.status === FileQueueStatus.Error;\r\n}\r\n","import { Observer, Observable } from 'rxjs';\r\nimport { Injectable } from '@angular/core';\r\nimport { HttpClient, HttpRequest, HttpEventType, HttpResponse, HttpErrorResponse, HttpHeaders } from '@angular/common/http';\r\n\r\nimport { FileQueueObject } from './file-queue-object';\r\nimport { FileQueueStatus } from './file-queue-status';\r\nimport { FileUploaderOptions, CropOptions } from './interfaces';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class ImageUploaderService {\r\n\r\n  constructor(private http: HttpClient) {}\r\n\r\n  uploadFile(file: File, options: FileUploaderOptions, cropOptions?: CropOptions): Observable<FileQueueObject> {\r\n    this.setDefaults(options);\r\n\r\n    const form = new FormData();\r\n    form.append(options.fieldName, file, file.name);\r\n\r\n    if (cropOptions) {\r\n      form.append('X', cropOptions.x.toString());\r\n      form.append('Y', cropOptions.y.toString());\r\n      form.append('Width', cropOptions.width.toString());\r\n      form.append('Height', cropOptions.height.toString());\r\n    }\r\n\r\n    // upload file and report progress\r\n    const req = new HttpRequest('POST', options.uploadUrl, form, {\r\n      reportProgress: true,\r\n      withCredentials: options.withCredentials,\r\n      headers: this._buildHeaders(options)\r\n    });\r\n\r\n    return Observable.create(obs => {\r\n      const queueObj = new FileQueueObject(file);\r\n\r\n      queueObj.request = this.http.request(req).subscribe(\r\n        (event: any) => {\r\n          if (event.type === HttpEventType.UploadProgress) {\r\n            this._uploadProgress(queueObj, event);\r\n            obs.next(queueObj);\r\n          } else if (event instanceof HttpResponse) {\r\n            this._uploadComplete(queueObj, event);\r\n            obs.next(queueObj);\r\n            obs.complete();\r\n          }\r\n        },\r\n        (err: HttpErrorResponse) => {\r\n          if (err.error instanceof Error) {\r\n            // A client-side or network error occurred. Handle it accordingly.\r\n            this._uploadFailed(queueObj, err);\r\n            obs.next(queueObj);\r\n            obs.complete();\r\n          } else {\r\n            // The backend returned an unsuccessful response code.\r\n            this._uploadFailed(queueObj, err);\r\n            obs.next(queueObj);\r\n            obs.complete();\r\n          }\r\n        }\r\n      );\r\n    });\r\n  }\r\n\r\n  getFile(url: string, options: { authToken?: string, authTokenPrefix?: string }): Observable<File> {\r\n    return Observable.create((observer: Observer<File>) => {\r\n      let headers = new HttpHeaders();\r\n\r\n      if (options.authToken) {\r\n        headers = headers.append('Authorization', `${options.authTokenPrefix} ${options.authToken}`);\r\n      }\r\n\r\n      this.http.get(url, { responseType: 'blob', headers: headers}).subscribe(res => {\r\n        const file = new File([res], 'filename', { type: res.type });\r\n        observer.next(file);\r\n        observer.complete();\r\n      }, err => {\r\n        observer.error(err.status);\r\n        observer.complete();\r\n      });\r\n    });\r\n  }\r\n\r\n  private _buildHeaders(options: FileUploaderOptions): HttpHeaders {\r\n    let headers = new HttpHeaders();\r\n\r\n    if (options.authToken) {\r\n      headers = headers.append('Authorization', `${options.authTokenPrefix} ${options.authToken}`);\r\n    }\r\n\r\n    if (options.customHeaders) {\r\n      Object.keys(options.customHeaders).forEach((key) => {\r\n        headers = headers.append(key, options.customHeaders[key]);\r\n      });\r\n    }\r\n\r\n    return headers;\r\n  }\r\n\r\n  private _uploadProgress(queueObj: FileQueueObject, event: any) {\r\n    // update the FileQueueObject with the current progress\r\n    const progress = Math.round(100 * event.loaded / event.total);\r\n    queueObj.progress = progress;\r\n    queueObj.status = FileQueueStatus.Progress;\r\n    // this._queue.next(this._files);\r\n  }\r\n\r\n  private _uploadComplete(queueObj: FileQueueObject, response: HttpResponse<any>) {\r\n    // update the FileQueueObject as completed\r\n    queueObj.progress = 100;\r\n    queueObj.status = FileQueueStatus.Success;\r\n    queueObj.response = response;\r\n    // this._queue.next(this._files);\r\n    // this.onCompleteItem(queueObj, response.body);\r\n  }\r\n\r\n  private _uploadFailed(queueObj: FileQueueObject, response: HttpErrorResponse) {\r\n    // update the FileQueueObject as errored\r\n    queueObj.progress = 0;\r\n    queueObj.status = FileQueueStatus.Error;\r\n    queueObj.response = response;\r\n    // this._queue.next(this._files);\r\n  }\r\n\r\n  private setDefaults(options: FileUploaderOptions) {\r\n    options.withCredentials = options.withCredentials || false;\r\n    options.httpMethod = options.httpMethod || 'POST';\r\n    options.authTokenPrefix = options.authTokenPrefix || 'Bearer';\r\n    options.fieldName = options.fieldName || 'file';\r\n  }\r\n}\r\n","import {ResizeOptions} from './interfaces';\r\n\r\nexport function createImage(url: string, cb: (i: HTMLImageElement) => void) {\r\n  const image = new Image();\r\n  image.onload = function () {\r\n    cb(image);\r\n  };\r\n  image.src = url;\r\n}\r\n\r\nconst resizeAreaId = 'imageupload-resize-area';\r\n\r\nfunction getResizeArea() {\r\n  let resizeArea = document.getElementById(resizeAreaId);\r\n  if (!resizeArea) {\r\n    resizeArea = document.createElement('canvas');\r\n    resizeArea.id = resizeAreaId;\r\n    resizeArea.style.display = 'none';\r\n    document.body.appendChild(resizeArea);\r\n  }\r\n\r\n  return <HTMLCanvasElement>resizeArea;\r\n}\r\n\r\nexport function resizeImage(origImage: HTMLImageElement, {\r\n  resizeHeight,\r\n  resizeWidth,\r\n  resizeQuality = 0.7,\r\n  resizeType = 'image/jpeg',\r\n  resizeMode = 'fill'\r\n}: ResizeOptions = {}) {\r\n\r\n  const canvas = getResizeArea();\r\n\r\n  let height = origImage.height;\r\n  let width = origImage.width;\r\n  let offsetX = 0;\r\n  let offsetY = 0;\r\n\r\n  if (resizeMode === 'fill') {\r\n    // calculate the width and height, constraining the proportions\r\n    if (width / height > resizeWidth / resizeHeight) {\r\n      width = Math.round(height * resizeWidth / resizeHeight);\r\n    } else {\r\n      height = Math.round(width * resizeHeight / resizeWidth);\r\n    }\r\n\r\n    canvas.width = resizeWidth <= width ? resizeWidth : width;\r\n    canvas.height = resizeHeight <= height ? resizeHeight : height;\r\n\r\n    offsetX = origImage.width / 2 - width / 2;\r\n    offsetY = origImage.height / 2 - height / 2;\r\n\r\n    // draw image on canvas\r\n    const ctx = canvas.getContext('2d');\r\n    ctx.drawImage(origImage, offsetX, offsetY, width, height, 0, 0, canvas.width, canvas.height);\r\n  } else if (resizeMode === 'fit') {\r\n      // calculate the width and height, constraining the proportions\r\n      if (width > height) {\r\n          if (width > resizeWidth) {\r\n              height = Math.round(height *= resizeWidth / width);\r\n              width = resizeWidth;\r\n          }\r\n      } else {\r\n          if (height > resizeHeight) {\r\n              width = Math.round(width *= resizeHeight / height);\r\n              height = resizeHeight;\r\n          }\r\n      }\r\n\r\n      canvas.width = width;\r\n      canvas.height = height;\r\n\r\n      // draw image on canvas\r\n      const ctx = canvas.getContext('2d');\r\n      ctx.drawImage(origImage, 0, 0, width, height);\r\n  } else {\r\n    throw new Error('Unknown resizeMode: ' + resizeMode);\r\n  }\r\n\r\n  // get the data from canvas as 70% jpg (or specified type).\r\n  return canvas.toDataURL(resizeType, resizeQuality);\r\n}\r\n\r\n\r\n","import {\r\n  Component, OnInit, OnDestroy, AfterViewChecked, ViewChild, ElementRef,\r\n  Renderer, Input, Output, EventEmitter, ChangeDetectorRef, forwardRef, HostListener\r\n} from '@angular/core';\r\nimport { ControlValueAccessor, NG_VALUE_ACCESSOR } from '@angular/forms';\r\nimport Cropper from 'cropperjs';\r\n\r\nimport { ImageUploaderService } from './image-uploader.service';\r\nimport { ImageUploaderOptions, ImageResult, ResizeOptions, CropOptions } from './interfaces';\r\nimport { createImage, resizeImage } from './utils';\r\nimport { FileQueueObject } from './file-queue-object';\r\n\r\nexport enum Status {\r\n  NotSelected,\r\n  Selected,\r\n  Uploading,\r\n  Loading,\r\n  Loaded,\r\n  Error\r\n}\r\n\r\n@Component({\r\n  selector: 'ngx-image-uploader',\r\n  template: `<div class=\"image-container\">\r\n  <div class=\"match-parent\" [ngSwitch]=\"status\">\r\n\r\n    <div class=\"match-parent\" *ngSwitchCase=\"statusEnum.NotSelected\">\r\n      <button type=\"button\" class=\"add-image-btn\" (click)=\"onImageClicked()\">\r\n          <div>\r\n            <p class=\"plus\">+</p>\r\n            <p>Click here to add image</p>\r\n            <p>Or drop image here</p>\r\n          </div>\r\n      </button>\r\n    </div>\r\n\r\n    <div class=\"selected-status-wrapper match-parent\" *ngSwitchCase=\"statusEnum.Loaded\">\r\n      <img [src]=\"imageThumbnail\" #imageElement>\r\n\r\n      <button type=\"button\" class=\"remove\" (click)=\"removeImage()\">Ã</button>\r\n    </div>\r\n\r\n    <div class=\"selected-status-wrapper match-parent\" *ngSwitchCase=\"statusEnum.Selected\">\r\n      <img [src]=\"imageThumbnail\" #imageElement>\r\n\r\n      <button type=\"button\" class=\"remove\" (click)=\"removeImage()\">Ã</button>\r\n    </div>\r\n\r\n    <div *ngSwitchCase=\"statusEnum.Uploading\">\r\n      <img [attr.src]=\"imageThumbnail ? imageThumbnail : null\" (click)=\"onImageClicked()\">\r\n\r\n      <div class=\"progress-bar\">\r\n        <div class=\"bar\" [style.width]=\"progress+'%'\"></div>\r\n      </div>\r\n    </div>\r\n\r\n    <div class=\"match-parent\" *ngSwitchCase=\"statusEnum.Loading\">\r\n      <div class=\"sk-fading-circle\">\r\n        <div class=\"sk-circle1 sk-circle\"></div>\r\n        <div class=\"sk-circle2 sk-circle\"></div>\r\n        <div class=\"sk-circle3 sk-circle\"></div>\r\n        <div class=\"sk-circle4 sk-circle\"></div>\r\n        <div class=\"sk-circle5 sk-circle\"></div>\r\n        <div class=\"sk-circle6 sk-circle\"></div>\r\n        <div class=\"sk-circle7 sk-circle\"></div>\r\n        <div class=\"sk-circle8 sk-circle\"></div>\r\n        <div class=\"sk-circle9 sk-circle\"></div>\r\n        <div class=\"sk-circle10 sk-circle\"></div>\r\n        <div class=\"sk-circle11 sk-circle\"></div>\r\n        <div class=\"sk-circle12 sk-circle\"></div>\r\n      </div>\r\n    </div>\r\n\r\n    <div class=\"match-parent\" *ngSwitchCase=\"statusEnum.Error\">\r\n      <div class=\"error\">\r\n        <div class=\"error-message\">\r\n          <p>{{errorMessage}}</p>\r\n        </div>\r\n        <button type=\"button\" class=\"remove\" (click)=\"dismissError()\">Ã</button>\r\n      </div>\r\n    </div>\r\n  </div>\r\n\r\n  <input type=\"file\" #fileInput (change)=\"onFileChanged()\">\r\n  <div class=\"drag-overlay\" [hidden]=\"true\" #dragOverlay></div>\r\n</div>\r\n`,\r\n  styles: [`:host{display:block}.match-parent{width:100%;height:100%}.add-image-btn{width:100%;height:100%;font-weight:700;opacity:.5;border:0}.add-image-btn:hover{opacity:.7;cursor:pointer;background-color:#ddd;box-shadow:inset 0 0 5px rgba(0,0,0,.3)}.add-image-btn .plus{font-size:30px;font-weight:400;margin-bottom:5px;margin-top:5px}img{cursor:pointer;position:absolute;top:50%;left:50%;margin-right:-50%;-webkit-transform:translate(-50%,-50%);transform:translate(-50%,-50%);max-width:100%}.image-container{width:100%;height:100%;position:relative;display:inline-block;background-color:#f1f1f1;box-shadow:inset 0 0 5px rgba(0,0,0,.2)}.remove{position:absolute;top:0;right:0;width:40px;height:40px;font-size:25px;text-align:center;opacity:.8;border:0;cursor:pointer}.selected-status-wrapper>.remove:hover{opacity:.7;background-color:#fff}.error .remove{opacity:.5}.error .remove:hover{opacity:.7}input{display:none}.error{width:100%;height:100%;border:1px solid #e3a5a2;color:#d2706b;background-color:#fbf1f0;position:relative;text-align:center;display:flex;align-items:center}.error-message{width:100%;line-height:18px}.progress-bar{position:absolute;bottom:10%;left:10%;width:80%;height:5px;background-color:grey;opacity:.9;overflow:hidden}.bar{position:absolute;height:100%;background-color:#a4c639}.drag-overlay{position:absolute;top:0;left:0;width:100%;height:100%;background-color:#ff0;opacity:.3}.sk-fading-circle{width:40px;height:40px;position:relative;top:50%;left:50%;-webkit-transform:translate(-50%,-50%);transform:translate(-50%,-50%)}.sk-fading-circle .sk-circle{width:100%;height:100%;position:absolute;left:0;top:0}.sk-fading-circle .sk-circle:before{content:'';display:block;margin:0 auto;width:15%;height:15%;background-color:#333;border-radius:100%;-webkit-animation:1.2s ease-in-out infinite both sk-circleFadeDelay;animation:1.2s ease-in-out infinite both sk-circleFadeDelay}.sk-fading-circle .sk-circle2{-webkit-transform:rotate(30deg);transform:rotate(30deg)}.sk-fading-circle .sk-circle3{-webkit-transform:rotate(60deg);transform:rotate(60deg)}.sk-fading-circle .sk-circle4{-webkit-transform:rotate(90deg);transform:rotate(90deg)}.sk-fading-circle .sk-circle5{-webkit-transform:rotate(120deg);transform:rotate(120deg)}.sk-fading-circle .sk-circle6{-webkit-transform:rotate(150deg);transform:rotate(150deg)}.sk-fading-circle .sk-circle7{-webkit-transform:rotate(180deg);transform:rotate(180deg)}.sk-fading-circle .sk-circle8{-webkit-transform:rotate(210deg);transform:rotate(210deg)}.sk-fading-circle .sk-circle9{-webkit-transform:rotate(240deg);transform:rotate(240deg)}.sk-fading-circle .sk-circle10{-webkit-transform:rotate(270deg);transform:rotate(270deg)}.sk-fading-circle .sk-circle11{-webkit-transform:rotate(300deg);transform:rotate(300deg)}.sk-fading-circle .sk-circle12{-webkit-transform:rotate(330deg);transform:rotate(330deg)}.sk-fading-circle .sk-circle2:before{-webkit-animation-delay:-1.1s;animation-delay:-1.1s}.sk-fading-circle .sk-circle3:before{-webkit-animation-delay:-1s;animation-delay:-1s}.sk-fading-circle .sk-circle4:before{-webkit-animation-delay:-.9s;animation-delay:-.9s}.sk-fading-circle .sk-circle5:before{-webkit-animation-delay:-.8s;animation-delay:-.8s}.sk-fading-circle .sk-circle6:before{-webkit-animation-delay:-.7s;animation-delay:-.7s}.sk-fading-circle .sk-circle7:before{-webkit-animation-delay:-.6s;animation-delay:-.6s}.sk-fading-circle .sk-circle8:before{-webkit-animation-delay:-.5s;animation-delay:-.5s}.sk-fading-circle .sk-circle9:before{-webkit-animation-delay:-.4s;animation-delay:-.4s}.sk-fading-circle .sk-circle10:before{-webkit-animation-delay:-.3s;animation-delay:-.3s}.sk-fading-circle .sk-circle11:before{-webkit-animation-delay:-.2s;animation-delay:-.2s}.sk-fading-circle .sk-circle12:before{-webkit-animation-delay:-.1s;animation-delay:-.1s}@-webkit-keyframes sk-circleFadeDelay{0%,100%,39%{opacity:0}40%{opacity:1}}@keyframes sk-circleFadeDelay{0%,100%,39%{opacity:0}40%{opacity:1}}`],\r\n  host: {\r\n    '[style.width]': 'thumbnailWidth + \"px\"',\r\n    '[style.height]': 'thumbnailHeight + \"px\"'\r\n  },\r\n  providers: [\r\n    {\r\n      provide: NG_VALUE_ACCESSOR,\r\n      useExisting: forwardRef(() => ImageUploaderComponent),\r\n      multi: true\r\n    }\r\n  ]\r\n})\r\nexport class ImageUploaderComponent implements OnInit, OnDestroy, AfterViewChecked, ControlValueAccessor {\r\n  statusEnum = Status;\r\n  _status: Status = Status.NotSelected;\r\n\r\n  thumbnailWidth = 150;\r\n  thumbnailHeight = 150;\r\n  _imageThumbnail: any;\r\n  _errorMessage: string;\r\n  progress: number;\r\n  origImageWidth: number;\r\n  orgiImageHeight: number;\r\n\r\n  cropper: Cropper = undefined;\r\n  fileToUpload: File;\r\n\r\n  @ViewChild('imageElement') imageElement: ElementRef;\r\n  @ViewChild('fileInput') fileInputElement: ElementRef;\r\n  @ViewChild('dragOverlay') dragOverlayElement: ElementRef;\r\n  @Input() options: ImageUploaderOptions;\r\n  @Output() upload: EventEmitter<FileQueueObject> = new EventEmitter<FileQueueObject>();\r\n  @Output() statusChange: EventEmitter<Status> = new EventEmitter<Status>();\r\n\r\n  propagateChange = (_: any) => {};\r\n\r\n  constructor(\r\n    private renderer: Renderer,\r\n    private uploader: ImageUploaderService,\r\n    private changeDetector: ChangeDetectorRef) { }\r\n\r\n  get imageThumbnail() {\r\n    return this._imageThumbnail;\r\n  }\r\n\r\n  set imageThumbnail(value) {\r\n    this._imageThumbnail = value;\r\n    this.propagateChange(this._imageThumbnail);\r\n\r\n    if (value !== undefined) {\r\n      this.status = Status.Selected;\r\n    } else {\r\n      this.status = Status.NotSelected;\r\n    }\r\n  }\r\n\r\n  get errorMessage() {\r\n    return this._errorMessage;\r\n  }\r\n\r\n  set errorMessage(value) {\r\n    this._errorMessage = value;\r\n\r\n    if (value) {\r\n      this.status = Status.Error;\r\n    } else {\r\n      this.status = Status.NotSelected;\r\n    }\r\n  }\r\n\r\n  get status() {\r\n    return this._status;\r\n  }\r\n\r\n  set status(value) {\r\n    this._status = value;\r\n    this.statusChange.emit(value);\r\n  }\r\n\r\n  writeValue(value: any) {\r\n    if (value) {\r\n      this.loadAndResize(value);\r\n    } else {\r\n      this._imageThumbnail = undefined;\r\n      this.status = Status.NotSelected;\r\n    }\r\n  }\r\n\r\n  registerOnChange(fn: (_: any) => void) {\r\n    this.propagateChange = fn;\r\n  }\r\n\r\n  registerOnTouched() {}\r\n\r\n  ngOnInit() {\r\n    if (this.options) {\r\n      if (this.options.thumbnailWidth) {\r\n        this.thumbnailWidth = this.options.thumbnailWidth;\r\n      }\r\n      if (this.options.thumbnailHeight) {\r\n        this.thumbnailHeight = this.options.thumbnailHeight;\r\n      }\r\n      if (this.options.resizeOnLoad === undefined) {\r\n        this.options.resizeOnLoad = true;\r\n      }\r\n      if (this.options.autoUpload === undefined) {\r\n        this.options.autoUpload = true;\r\n      }\r\n      if (this.options.cropEnabled === undefined) {\r\n        this.options.cropEnabled = false;\r\n      }\r\n\r\n      if (this.options.autoUpload && this.options.cropEnabled) {\r\n        throw new Error('autoUpload and cropEnabled cannot be enabled simultaneously');\r\n      }\r\n    }\r\n  }\r\n\r\n  ngAfterViewChecked() {\r\n    if (this.options && this.options.cropEnabled && this.imageElement && this.fileToUpload && !this.cropper) {\r\n      this.cropper = new Cropper(this.imageElement.nativeElement, {\r\n        viewMode: 1,\r\n        aspectRatio: this.options.cropAspectRatio ? this.options.cropAspectRatio : null\r\n      });\r\n    }\r\n  }\r\n\r\n  ngOnDestroy() {\r\n    if (this.cropper) {\r\n      this.cropper.destroy();\r\n      this.cropper = null;\r\n    }\r\n  }\r\n\r\n  loadAndResize(url: string) {\r\n    this.status = Status.Loading;\r\n\r\n    this.uploader.getFile(url, this.options).subscribe(file => {\r\n      if (this.options.resizeOnLoad) {\r\n        // thumbnail\r\n        const result: ImageResult = {\r\n          file: file,\r\n          url: URL.createObjectURL(file)\r\n        };\r\n\r\n        this.resize(result).then(r => {\r\n          this._imageThumbnail = r.resized.dataURL;\r\n          this.status = Status.Loaded;\r\n        });\r\n      } else {\r\n        const result: ImageResult = {\r\n          file: null,\r\n          url: null\r\n        };\r\n\r\n        this.fileToDataURL(file, result).then(r => {\r\n          this._imageThumbnail = r.dataURL;\r\n          this.status = Status.Loaded;\r\n        });\r\n      }\r\n    }, error => {\r\n      this.errorMessage = error || 'Error while getting an image';\r\n    });\r\n  }\r\n\r\n  onImageClicked() {\r\n    this.renderer.invokeElementMethod(this.fileInputElement.nativeElement, 'click');\r\n  }\r\n\r\n  onFileChanged() {\r\n    const file = this.fileInputElement.nativeElement.files[0];\r\n    if (!file) {\r\n      return;\r\n    }\r\n\r\n    this.validateAndUpload(file);\r\n  }\r\n\r\n  validateAndUpload(file: File) {\r\n    this.propagateChange(null);\r\n\r\n    if (this.options && this.options.allowedImageTypes) {\r\n      if (!this.options.allowedImageTypes.some(allowedType => file.type === allowedType)) {\r\n        this.errorMessage = 'Only these image types are allowed: ' + this.options.allowedImageTypes.join(', ');\r\n        return;\r\n      }\r\n    }\r\n\r\n    if (this.options && this.options.maxImageSize) {\r\n      if (file.size > this.options.maxImageSize * 1024 * 1024) {\r\n        this.errorMessage = `Image must not be larger than ${this.options.maxImageSize} MB`;\r\n        return;\r\n      }\r\n    }\r\n\r\n    this.fileToUpload = file;\r\n\r\n    if (this.options && this.options.autoUpload) {\r\n      this.uploadImage();\r\n    }\r\n\r\n    // thumbnail\r\n    const result: ImageResult = {\r\n      file: file,\r\n      url: URL.createObjectURL(file)\r\n    };\r\n\r\n    this.resize(result).then(r => {\r\n      this._imageThumbnail = r.resized.dataURL;\r\n      this.origImageWidth = r.width;\r\n      this.orgiImageHeight = r.height;\r\n\r\n      if (this.options && !this.options.autoUpload) {\r\n        this.status = Status.Selected;\r\n      }\r\n    });\r\n  }\r\n\r\n  uploadImage() {\r\n    this.progress = 0;\r\n    this.status = Status.Uploading;\r\n\r\n    let cropOptions: CropOptions;\r\n\r\n    if (this.cropper) {\r\n      const scale = this.origImageWidth / this.cropper.getImageData().naturalWidth;\r\n      const cropData = this.cropper.getData();\r\n\r\n      cropOptions = {\r\n        x: Math.round(cropData.x * scale),\r\n        y: Math.round(cropData.y * scale),\r\n        width: Math.round(cropData.width * scale),\r\n        height: Math.round(cropData.height * scale)\r\n      };\r\n    }\r\n\r\n   // const queueObj = this.uploader.uploadFile(this.fileToUpload, this.options, cropOptions);\r\n\r\n    // file progress\r\n    this.uploader.uploadFile(this.fileToUpload, this.options, cropOptions).subscribe(file => {\r\n      this.progress = file.progress;\r\n\r\n      if (file.isError()) {\r\n        if (file.response.status || file.response.statusText) {\r\n          this.errorMessage = `${file.response.status}: ${file.response.statusText}`;\r\n        } else {\r\n          this.errorMessage = 'Error while uploading';\r\n        }\r\n        // on some upload errors change detection does not work, so we are forcing manually\r\n        this.changeDetector.detectChanges();\r\n      }\r\n\r\n      if (!file.inProgress()) {\r\n        // notify that value was changed only when image was uploaded and no error\r\n        if (file.isSuccess()) {\r\n          this.propagateChange(this._imageThumbnail);\r\n          this.status = Status.Selected;\r\n          this.fileToUpload = undefined;\r\n        }\r\n\r\n        this.upload.emit(file);\r\n      }\r\n    });\r\n  }\r\n\r\n  removeImage() {\r\n    this.fileInputElement.nativeElement.value = null;\r\n    this.imageThumbnail = undefined;\r\n\r\n    if (this.cropper) {\r\n      this.cropper.destroy();\r\n      this.cropper = null;\r\n    }\r\n  }\r\n\r\n  dismissError() {\r\n    this.errorMessage = undefined;\r\n    this.removeImage();\r\n  }\r\n\r\n  @HostListener('drop', ['$event']) drop(e: DragEvent) {\r\n    e.preventDefault();\r\n    e.stopPropagation();\r\n\r\n    if (!e.dataTransfer || !e.dataTransfer.files.length) {\r\n      return;\r\n    }\r\n\r\n    this.validateAndUpload(e.dataTransfer.files[0]);\r\n    this.updateDragOverlayStyles(false);\r\n  }\r\n\r\n  @HostListener('dragenter', ['$event']) dragenter(e: DragEvent) {\r\n    e.preventDefault();\r\n    e.stopPropagation();\r\n  }\r\n\r\n  @HostListener('dragover', ['$event']) dragover(e: DragEvent) {\r\n    e.preventDefault();\r\n    e.stopPropagation();\r\n    this.updateDragOverlayStyles(true);\r\n  }\r\n\r\n  @HostListener('dragleave', ['$event']) dragleave(e: DragEvent) {\r\n    e.preventDefault();\r\n    e.stopPropagation();\r\n    this.updateDragOverlayStyles(false);\r\n  }\r\n\r\n  private updateDragOverlayStyles(isDragOver: boolean) {\r\n    // TODO: find a way that does not trigger dragleave when displaying overlay\r\n    // if (isDragOver) {\r\n    //  this.renderer.setElementStyle(this.dragOverlayElement.nativeElement, 'display', 'block');\r\n    // } else {\r\n    //  this.renderer.setElementStyle(this.dragOverlayElement.nativeElement, 'display', 'none');\r\n    // }\r\n  }\r\n\r\n  private resize(result: ImageResult): Promise<ImageResult> {\r\n    const resizeOptions: ResizeOptions = {\r\n      resizeHeight: this.thumbnailHeight,\r\n      resizeWidth: this.thumbnailWidth,\r\n      resizeType: result.file.type,\r\n      resizeMode: this.options.thumbnailResizeMode\r\n    };\r\n\r\n    return new Promise((resolve) => {\r\n      createImage(result.url, image => {\r\n        const dataUrl = resizeImage(image, resizeOptions);\r\n\r\n        result.width = image.width;\r\n        result.height = image.height;\r\n        result.resized = {\r\n          dataURL: dataUrl,\r\n          type: this.getType(dataUrl)\r\n        };\r\n\r\n        resolve(result);\r\n      });\r\n    });\r\n  }\r\n\r\n  private getType(dataUrl: string) {\r\n    return dataUrl.match(/:(.+\\/.+;)/)[1];\r\n  }\r\n\r\n  private fileToDataURL(file: File, result: ImageResult): Promise<ImageResult> {\r\n    return new Promise((resolve) => {\r\n      const reader = new FileReader();\r\n      reader.onload = function (e) {\r\n        result.dataURL = reader.result;\r\n        resolve(result);\r\n      };\r\n      reader.readAsDataURL(file);\r\n    });\r\n  }\r\n}\r\n","import { NgModule } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { HttpClientModule } from '@angular/common/http';\r\n\r\nimport { ImageUploaderComponent } from './image-uploader.component';\r\n\r\n@NgModule({\r\n  imports: [\r\n    CommonModule,\r\n    HttpClientModule\r\n  ],\r\n  declarations: [ImageUploaderComponent],\r\n  exports: [ImageUploaderComponent]\r\n})\r\nexport class ImageUploaderModule { }\r\n"],"names":[],"mappings":"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"}
